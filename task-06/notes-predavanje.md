## Agenda

- IAM users
    - Console access
    - Programmatic access
- IAM Groups
- IAM Roles
- IAM Policies - koju akciju user moze ili ne moze da izvrsi unutar AWS-a.
    - Customer managed policies - koje kreiramo sami
    - Managed policies - koje kreira AWS za nas
- AWS CLI
    - Create First AWS instance
- AWS Free Tier
- Mozemo koristiti aws calculator da vidimo koliko smo resursa potrosili ili koliko cemo potrositi sa instancom.

### Logovanje u account

- Ulogovati se na AWS racun kao IAM administrator jer root je tu samo da kreiramo account i odradimo osnovna podesavanja. Imamo samo 9 stvari za koje nam je root potreban.
    
- Kako kao root user resetovati password za svog IAM usera?
    
    - Idemo na IAM Dashboard.
    - Kliknemo na tab Users - zatim na korisnika za kojeg zelimo promijeniti passw.
    - Kliknemo na security credentials - manage console access - autogenerated password.
    - Selektovati User must create new password at next sign-in.
    - Download CSV file sa kredencijalima.
- Preporuka za koristenje password managera.
    
- Na IAM Dashboardu, na lijevoj strani gdje imamo Policies, kad kliknemo na iste vidjet cemo da imamo 1058 policies.
    
    - Policies definisu koje akcije mogu da se naprave nad nasim racunom.
- Kad pronadjemo policie koje se ticu administratora, nas zanima AdministratorAccess policy, kad kliknemo na isti vidimo da je napisan u JSON.
    
- ![af6645ba46ca8eb847ef7eefe08ada4c.png](../../_resources/af6645ba46ca8eb847ef7eefe08ada4c.png)
    
- `Version` znaci verziju jezika u kojem se pise ovaj AWS policy. Defaultna linija koja se navodi poslije otvorene viticaste zagrade.
    
- `Statement` dio oznacava sta dozvoljavamo a sta zabranjujemo unutar naseg AWS racuna.
    
- `Actions` koje akcije i `Resource` nad kojim resursima. Resurs moze biti npr. EC2 instanca.
    
- Treba imati na umu da `AWS managed` znaci da se AWS brine za ove policie, azurira ih i updateuje ujedno.
    

## Sami mozemo kreirati policy

- Kada kliknemo na `Create policy` sami mozemo da kreiramo svoj policy.
    
- ![e2e959aef29bd293fb2ff62ee68feeef.png](../../_resources/e2e959aef29bd293fb2ff62ee68feeef.png)
    
- Mozemo koristiti JSON da kreiramo svoj policy ili Visual editor.
    
- `Choose service` \- biramo servis na kojim zelimo kreirati policy.
    
- `Actions` \- koje akcije zelimo da dozvolimo nad servisom koji smo izabrali. (npr. na EC2)
    
- Ovdje nas zanima start instance (`StartInstances`) koju cemo selektovati.
    
- `Resources` \- nad kojim resource-om zelimo da dozvolimo. Selektujemo `All Resources`.
    
- `Request Conditions` \- ovdje postavljamo odredjene uslove.
    
    - Npr. korisnik moze da pristupi samo sa odredjene IP adrese.
    - Isto mozemo postaviti poseban uslov na `Add request condition`, gdje Condition key moze biti neki Region - `ec2:Region`. Podesimo Operator na `StringEquals` i Value na `eu-central-1`.
- Ako se vratimo nazad na JSON tab vidjet cemo kako izgleda policy koji smo kreirali:
    
- ![29bcf2952034ed4b759dc3858928887f.png](../../_resources/29bcf2952034ed4b759dc3858928887f.png)
    
- Sid je identifikator koji mozemo izmijeniti, npr. mozemo napisati nesto sto je razumljivije krajnjem korisniku kao `StartEC2Instance`.
    

## Tagovi

- Poslije toga kliknemo na button `Next: Tags`. Sta su to tagovi? Tagovi su dodatne informacije o resursima koje mi kreiramo unutar AWS.
    
- AWS resursi su identifikovani unutar AWS konzole uz pomoc ARN - Amazon Resource Number, uz pomoc kojeg AWS identificira resurse unutar AWS racuna, medjutim krajnjem korisniku cesto taj ARN nije dovoljno razumljiv ili mu je potrebno vise informacija i zato se dodaju tagovi.
    
- Tagovi sluze kako bi pruzili dodatne informacije odnosno meta-data o odredjenom resursu.
    
- ![6ca47473a77611030b756aaacd9eb8d9.png](../../_resources/6ca47473a77611030b756aaacd9eb8d9.png)
    

## Review

- Poslije toga kliknemo na button `Next: Review`.
    
- ![d4e78e27163659c2977705c9b5f6ed2a.png](../../_resources/d4e78e27163659c2977705c9b5f6ed2a.png)
    
- Poslije kad kliknemo na Create policy vidjet cemo da imamo policy koji se naziva CustomEC2Policy i da je Customer managed, sto znaci da je policy kreiran od strane korisnika.
    

## Sta dalje?

- Idemo na Users i da pronadjemo grupu koju smo kreirali - Tier2 i da toj grupi pridruzimo nas custom policy koji smo kreirali. Tako ce nasa grupa Tier2 korisnika imati CustomEC2Policy. I to je to.

## Sta to sad ovdje imamo?

- Imamo naseg korisnika, koji ukoliko zeli da se loguje na AWS racun, mora da ima IAM username i password, i te detalje ce koristiti za autentifikaciju, medjutim ako zeli da napravi neku akciju nakon prijave - kao sto je kreiranje EC2 instance, da pokrene EC2 instancu, sto zavisi od policy-a jer policy ce definisati da li taj nas user ima prava nad tim resursima.
- Unutar tog policy-a ce provjeriti se sljedece (na slici u JSON kodu). Provjerava se da li je Effect allow ili deny, ako je deny korisnik nece imati pristup AWS resursu, ako je Effect allow provjerava se akcija - u ovom slucaju EC2:StartInstance, sljedeca stvar je Resource, gdje imamo wildcard sto znaci da moze, condition - ukoliko se nalazi u regiji eu-central-1 znaci moze izvrsiti akciju ukoliko se taj resurs nalazi unutar specificne regije, u ostalim regijama nece moci da izvrsi ovu akciju.
- ![d3f5dad9d8a2f1eead08375c3860355a.png](../../_resources/d3f5dad9d8a2f1eead08375c3860355a.png)
- Ovo sad sto smo napravili se zove least privilege system gdje mi nekom korisniku dodjeljujemo najmanji moguci nivo privilegija kako bi oni mogli da obave neophodan zadatak. Sve vise od toga predstavlja potencijalni sigurnosni rizik.

## User koji ima administratorske privilegije - IAM user koji je admin - kreiranje EC2 instance

- Sa ovim userom cemo kreirati prvu EC2 instancu putem EC2 Dashboarda.
- EC2 - Elastic Compute Cloud (skracenica).
- EC2 Dashboard je mjesto gdje upravljamo nasim EC2 instancama. Virtuelna masina je EC2 instanca.
- Prije kreiranja instance, bitno da smo u regiji eu-central-1 tj. Frankfurt.
- Zatim odabiremo i popunjavamo sljedece:
- `Launch Instance` \- da se pokrene kreiranje EC2 instance.
    - `Name` \- ime instance, smisleno ime, naming konvencija - `ec2-euc1-ime-prezime`
    - Dodatni tagovi - mozemo CreatedBy, value info - ime i prezime.
- `AMI image` \- Amazon Machine Image
    - Jedan AMI moze biti iskoristen za kreiranje desetina ili stotina EC2 instanci.
    - Komparacija sa instalacijskim CDom za sistem.
    - Unutar AWS-a mi nemamo CDove ali imamo AMI-e koji su template-i na osnovu kojih kasnije kreiramo nasu EC2 instancu.
    - AMI sadrzi podatke o OS-u koji cemo da koristimo. Moze se zamisliti kao image na kojem se nalaze podaci o nasem OSu kojeg cemo kasnije koristiti.
    - Mi cemo izabrati `Amazon Linux AMI`.
    - Bitno obratiti paznju kada selektujemo da je Free Tier Eligible
- `Instance Type` \- definise velicinu naseg servera.
    - `t2.micro` \- free tier eligible
- Prije nego nastavimo, trebamo pogledati sta znaci free tier.

## Sta znaci Free tier?

- Godinu dana koristimo odredjene service u odredjenom obimu potpuno besplatno.
- Ukoliko kreiramo EC2 instancu, moze biti pokrenuta 750h besplatno pod odr. uslovima.
- Uslovi su da instanca pripada odredjenoj grupi instanci.
- Pogledati tipove instanci ovdje: https://aws.amazon.com/ec2/instance-types
- Instance naming - sta znaci t2.micro ili t3.micro ime? Kako se tipovi instance obiljezavaju? Primjer sa `t2.micro`
    - prvo slovo `t` \- oznacava familiju instance kojoj taj tip instance pripada. Imati na umu da se provjere razlicite familije instanci i zasto ih imamo toliko - npr. general purpose instance, memory optimized, compute optimized itd.
        - General purpose instance - daju neki balans izmedju memorije i CPU.
        - Memory optimized - gravitiraju vise prema memoriji nego CPU.
        - Compute optimized - vise prema CPU nego memoriji.
    - Baze podataka su storage heavy i zbog toga treba nam Storage optimized tip instance.
    - `M7g` \- instance koje koriste Graviton procesore.
    - `M6I` \- instance koje koriste Intel procesore itd.
- dalje, u `t2.micro`, broj `2` oznacava generaciju instance. Instance generacije `3` koriste noviji hardver i procesore i samim tim imaju bolje performanse. U nekim slucajevima jeftinije nam je koristiti t3.micro nego t2.micro;
- Za exam bitno je koje tipove instanci imamo na raspolaganju i u zavisnosti od cega trebamo izabrati neku instancu, prethodni primjer sa memory heavy app, biramo instancu koja pripada memory optimized familiji.
- `t` family instanci je namijenjena za testiranje, tj. nisu namijenjene za produkciju iz razloga sto njih karakterise `brustable` CPU. Kasnije cemo detaljnije o ovom pojmu.
- Za produkcijsko okruzenje koristimo neke od ostalih tipova instanci.

## nastavak kreiranja EC2 instance

- `Instance Type` \- izabrati t2.micro jer je free tier eligible.
    - Unutar naseg racuna imamo 1 EC2 instancu t2.micro i tu mozemo drzati 750 sati besplatno, medjutim ako drugi korisnik pokrene EC2 instancu, ova instanca ce biti naplacena. Mozemo vise instanci imati pokrenuto ali ako su pokrenute manje od 750 sati mjesecno sveukupno, treba voditi racuna o tome.
- `Key pair login` \- kljuc koji cemo koristiti za login na tu EC2 instancu. Key pair name - ime-prezime-ec2-key-pair; Key pair type - enkripcija ED25519; private key file format - .pem; Create key Pair.
    - Dobijemo fajl sa key pairom i imamo privatni kljuc koji se preuzeo na nasu masinu i vracamo se nazad na kreiranje EC2 instance.
- `Network settings` \- ukljucuju VPC gdje cemo ostaviti sve defaultne postavke, kasnije cemo detaljnije o VPCu.
- `Firewalls - security group` \- na nivou nase instance mozemo kreirati security group koji se ponasa kao firewall, definisemo inbound i outbound rules, ako zelimo da se SSHiramo na instancu, trebamo kreirati security group koja ce dozvoliti inbound traffic po portu 22.
    - kliknemo na `Edit` \- Security group name moze biti sec-group-ec2-ime-prezime.
    - Description moze biti security group used for EC2 instance created by ime-prezime
    - Security group rule - definisan ssh, source type - anywhere, zato imamo wildcard 0.0.0.0/0 i description - mozemo dodati "Allow SSH Access from Anywhere".
- `Configure Storage` \- EC2 instanca sama po sebi nudi samo CPU i RAM resurse. Storage, odnosno HDD se unutar AWS naziva `EBS` ili Elastic Block Storage. Nasa EC2 instanca sa ovim svojim diskom komunicira koristeci mrezu. Nasa EC2 instanca nema uz sebe fizicki zakacen HDD. Prilikom kreiranja EC2 moramo definisati velicinu storage-a ili mozemo dodati vise diskova ako zelimo, ali mi cemo dodati 29 GiB zato sto 30 izlazi iz Free Tier paketa.
    - `1x29` GiB `gp3` \- general purpose 3 ili general purpose 2.
- Bitna napomena - `EBS` moze da zivi nezavisno od nase EC2 instance. Npr. nasa EC2 instanca moze biti terminirana (izbrisana), storage nastavlja i dalje biti aktivan, mozemo kreirati novu EC2 instancu i njoj pridruziti vec postojeci EBS.
- `Advanced Details` \- trenutno preskacemo.
- Sljedeci korak je `Launch Instance`.
- Ako kliknemo na ID instance, prebaciti cemo se na tab instances.

## SSHiranje na EC2 instancu

- Na instance tabu vidimo Public IP adresu i Private IPv4 adress.
- Za inbound i outbound imamo rules, inbound rules - pravila za dolazni saobracaj po portu 22. Mrezni saobr. je dvosmjeran, sto znaci ako smo uputili request, ta instanca treba da odgovori na request. Po defaultu instance dozvoljavaju sav odlazni saobracaj, dok je na nama da definisemo inbound rules tj. ulazni saobracaj.
- `SSHiranje na EC2 instancu` putem naseg privatnog kljuca, .pem fajla koji cemo iskorisiti da se spojimo na instancu.
    - Provjeriti permisije nad kljucem (tj. fajlom) - `ls -la ime-prezime-ec2-key-pair.pem`
    - `chmod 600 key-pair.pem`
    - Imati na umu da za Amazon Linux instance default username je `ec2-user`
    - Koristimo public IP adresu nase instance.
    - `ssh -i "ime-prezime-ec2-key-pair.pem" ec2-user@public-ip-address`

## Dijagrami

- Preporuka koristiti lucid.app za izradu dijagrama.
- `IAM` servis je globalni servis i nema neku specificnu regiju kojoj pripada dok `EC2` instance su regionalni servisi.
- ![7ecac56bdae56f314dea1a30fd840177.png](../../_resources/7ecac56bdae56f314dea1a30fd840177.png)
- User koristeci IAM servis sa permisijama moze da manipulise EC2 instancom.
- Zatim imamo drugog korisnika koji treba da se spoji na EC2 instancu koristeci SSH protokol.
    - Da bi se spojili na tu EC2 instancu kreirali smo security groupu koja je firewall za tu EC2 instancu.
    - EC2 instanca ima svoju availability zonu koju mozemo provjeriti na Instances tabu.
- ![5fbf77738cecdac7bdbf9154db5cffbb.png](../../_resources/5fbf77738cecdac7bdbf9154db5cffbb.png)

## AWS CLI - Command Line Interface - instalacija i koristenje

- Do sada smo sve radili kroz konzolu, medjutim sa AWS servisima mozemo komunicirati kroz API, tj. kroz terminal.
    
- Na `IAM` Dashboardu, kliknemo na `Users` i scrollamo dole do `Access Keys` koje koristimo za programmatic access nasem AWS racunu, tj. za koristenje terminala pri radu sa servisima.
    
- U nasem terminalu, na nasem laptopu, mozemo instalirati AWS CLI.
    
- https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html
    
- Poslije toga: `aws --version`
    
- Konfiguracija AWS CLI - lokalno svoj profil za komunikaciju sa AWS
    
    - `aws configure` \- prompt za AWS Access Key koji trebamo unijeti.
    - AWS Access Key mozemo posmatrati nasim usernameom kada se spajamo na AWS kroz konzolu. Vratimo se na Users - Access Keys na nasem IAM admin accountu.
    - Kliknemo na Create Access Key za CLI.
    - Set description tag - name AWS CLI
    - Kopiramo Access Key i pasteamo u nas terminal.
    - Secret access key prompt - na nasem accountu imamo i secret access key, koji mozemo vidjeti samo jednom. Kopiramo i paste-ujemo.
    - Default region name - kliknemo Enter.
    - Default output format - Enter.
- Na nasem laptopu ce biti kreiran direktorij koji se zove `.aws` u kojem imamo config i credentials fajlove.
    
- Kad kliknemo `Done` na nasem profilu, za naseg usera mozemo vidjeti access key i da je aktivan, medjutim do sada nije koristen.
    

## Prakticna upotreba naseg access key-a

- Nas zanima koje instance imamo pokrenute unutar naseg AWS racuna - nema potrebe da idemo na konzolu i klikamo kroz nju, mozemo koristit CLI:
    
    - `aws ec2 describe-instances` \- output ce biti nepregledan pa cemo staviti output da bude u json formatu
    - `aws ec2 describe-instances --output json` \- poprilicno preglednije
- Ako zelimo vidjeti koja je javna IP adresa nase EC2 instance - mozemo kombinovati shell skriptu sa nasom aws komandom:
    
    - `aws ec2 describe-instances --query "Reservations[*].Instances[*].PublicIpAddress"` \- dobiti cemo svoju javnu IP adresu.
- U dokumentaciji AWS CLI COmmand Refence mozemo vidjeti sve dostupne servise i npr. kad kliknemo na EC2 servis vidjeti cemo koje dostupne komande imamo za nasu EC2 instancu.
    
- Sintaksa za CLI komande - uvijek pisemo `aws` na pocetku sto oznacava aws CLI, zatim ime servisa, npr `ec2` zatim pisemo komandu koju zelimo da koristimo za taj servis: `aws ec2 describe-instances`.
    
- Npr. da preimenujemo svog IAM usera - `aws iam update-user --user-name ime.prezime --new-user-name bob.marley`
    

## IAM user - custom policy - da vidi nasu EC2 instancu.

- IAM korisnik nema permisiju da kreira instancu van eu-central-1 regije.
- Akcija koju smo prethodno kreirali nije dovoljna sto znaci da treba da editujemo nas policy, dodamo jos neke akcije.
- Kao admin IAM idemo na Edit Custom EC2Policy, dozvoliti cemo svom IAM useru da ima sve akcije nad EC2 pod uslovom da se nalazi u regiji eu-central-1. Medjutim zelimo da mu zabranimo da brise tu EC2 instancu.
    - ![e16fadcb1b1b0ddebdf5089a2589306b.png](../../_resources/e16fadcb1b1b0ddebdf5089a2589306b.png)
- Ovdje cemo isto dodati novi SID sa zabranom EC2 termination.
    - ![5b8d5369d066830fa5db44cb08227b99.png](../../_resources/5b8d5369d066830fa5db44cb08227b99.png)
- Kliknemo na Review Policy.
- IAM user ce moci da vidi nasu EC2 instancu.

## Terminiranje instance

- U `Instances` \- opcijama - `Instance state` mozemo terminate instance.
- Nas IAM user moze stopirati instancu ali ne moze terminirati instancu.

## Stanja u kojem instanca moze da se nalazi

- Status running - pokrenuta. Placamo storage, CPU i RAM resurse.
- Da stopiramo tu instancu - Status stop. Ne placamo CPU i RAM ali placamo storage. Mozemo ponovo da pokrenemo.
- Status terminated. Brisanje.
- Nasu instancu mozemo da restartujemo.

## Razlika izmedju stop, start i restart instance?

- Bitna stvar - unutar datacentra imamo neki server unutar kojeg se nalazi nasa EC2 instanca.
- Mi dijelimo taj server sa drugim korisnicima AWS-a. Zahvaljujuci virtualiziji resursi su izolovani ali nalaze se na istom serveru.
- Kada kazemo restart unutar AWS konzole, EC2 instanca ce pokrenuti se na istom hostu tj. serveru ali kad kazemo start i stop ta instanca ce promijeniti fizicki server na kojem se nalazi.
- Kad uradimo restart, instanca ce pokrenuti se na istom fizickom serveru.

## Promjena ip adrese - elastic vs. public ip adress

- Nakon sto stopiramo pa pokrenemo nasu instancu, ne mijenja se privatna ali mijenja se public ip adresa.
- Razlika izmedju Elastic IP address i public IP address - obje su public ali razlika je u tome sto elastic IP adresa se nece mijenjati kad odradimo stop i start nase EC2 instance.
- Vise o tome cemo kad budemo pricali o VPC-u.

## IAM policy evaluation

- Van scope-a ovog predavanja, o tome cemo pricati posebno.
- Shared tendency - vise korisnika dijeli jedan fizicki server u datacentru.

## EC2 Specifications

- `Tenancy` \- Shared instances zbog manjih troskova, dedicated instances su visi troskovi.
- `Operating system` \- izabrati cemo Linux.
- `Workloads` \- Constant
- `Number of instances` \- 1
- `Tip instance` \- t2.micro
- `Payment options` \- selektirati On Demand opciju.
- `Storage amount` \- napisati 14 GB (imamo 2 korisnika - 2x14 je manje od 30 GB koliko imamo u Free Tier).

## Bitna napomena

- Kada terminiramo instancu, terminira se i storage osim ako ne ukljucimo opciju pri kreiranju instance da ne brise se Elastic Block Storage.
- Na iducem predavanju kreirati cemo custom AMI image koji cemo koristiti za kreiranje instanci ubuduce.

## Homework

- Account owner
    
    - Kreiraj custom policy koji ce dozvoliti sve akcije nad ec2 instancom u svim regijama lia samo za instance tipa t2.micro
- Svi:
    
    - Kreiraj EC2 instancu t2.micro, koristeci Amazon Linux 3
    - instaliraj nginx
    - podesi da nginx se defaultno pokrece sa startovanjem instance
    - stopiraj instancu kad zavrsis sa njenim koristenjem